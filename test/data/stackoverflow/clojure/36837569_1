(let [_ (init-config! path)
                 _ (write-affectations)
                 _ (write-pages)
                 _ (spit "prepared-pages.edn" (prn-str (prepare-pages (read-pages))) :append :true)
                 _ (write-stock)
                 _ (write-prices)
                 _ (write-xx-prices)
                 _ (write-brands)
                 _ (write-g)
                 _ (write-vehicles)
                 _ (write-sales)
                 _ (write-sales-month)
                 _ (System/gc)
                stock (read-stock)
                affectations (read-affectations)
                pages (read-pages)
                prepared-pages (prepare-pages pages)
                xx-prices (read-xx-prices)
                g (read-g)
                brands (read-brands)
                prices (read-prices)
                sales (read-sales)
                sales-month (read-sales-month)
                pages-stock (merge-pages-stock stock prepared-pages xx-prices g brands prices sales sales-month)
                pages-stock-excluded (merge-pages-stock-excluded prepared-pages stock g brands prices sales sales-month)
                full-pages-per-page (-> (merge-full-pages pages-stock pages-stock-excluded)
                                        (merge-full-pages-per-page))
                pages-stock-per-page (merge-pages-stock-per-page pages-stock)
                affectations-count (merge-affectations-count affectations)
                summary-pages (doall (merge-summary-pages pages-stock full-pages-per-page pages-stock-per-page affectations-count))
                _ (System/gc)
                _ (io/delete-file "affectations.edn")
                _ (io/delete-file "pages.edn")
                _ (io/delete-file "prepared-pages.edn")
                _ (io/delete-file "stock.edn")
                _ (io/delete-file "prices.edn")
                _ (io/delete-file "xx-prices.edn")
                _ (io/delete-file "brands.edn")
                _ (io/delete-file "g.edn")
                _ (io/delete-file "vehicles.edn")
                _ (io/delete-file "sales.edn")
                _ (io/delete-file "sales-month.edn")